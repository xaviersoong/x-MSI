X-Dimensional Mass Spectrometry Imaging (MSI(x), or MSI-x)
=====================================
I. Standalone Software and Running Environment
=====================================
   MATLAB 2021a (Mathworks, Natick, MA, USA)
   Dell Inspiron 3593
   Processor Intel(R) Core(TM) i7-1065G7 CPU @ 1.30GHz 1.50 GHz
   Installed RAM 16.0 GB (15.8 GB usable)
   Windows 10 Home, Version 20H2  
   System type	64-bit operating system, x64-based processor

   The whole run time for MSI(x) varied from 30-60 minutes in total.

=====================================
II. LIVE SCRIPT CODE
=====================================
There are three parts of codes to implement the MSI(x) method:
Part 1: steps to generate some commonly shared variables that are used in Part 2 code.

    x-MSI_part1_file preparation and statistics.mlx

Part 2: steps to prepare the group-specific data stored in a separate folder for follow-up run in the Part 3 code. 
    x-MSI_part2_wba_untarget_posneg_A.mlx
    x-MSI_part2_wba_untarget_posneg_B.mlx
    x-MSI_part2_wba_untarget_posneg_C.mlx
    x-MSI_part2_wba_untarget_posneg_D.mlx
    x-MSI_part2_wba_untarget_posneg_E.mlx
    x-MSI_part2_wba_untarget_posneg_F.mlx
    x-MSI_part2_wba_untarget_posneg_G.mlx
   
    x-MSI_part2_tumor_untarget_neg_B.mlx
    x-MSI_part2_tumor_untarget_neg_C.mlx
    x-MSI_part2_tumor_untarget_neg_D.mlx
    x-MSI_part2_tumor_untarget_neg_E.mlx
    x-MSI_part2_tumor_untarget_neg_F.mlx
    x-MSI_part2_tumor_untarget_neg_G.mlx

    x-MSI_part2_tumor_target_neg_B.mlx
    x-MSI_part2_tumor_target_neg_C.mlx
    x-MSI_part2_tumor_target_neg_D.mlx
    x-MSI_part2_tumor_target_neg_E.mlx
    x-MSI_part2_tumor_target_neg_F.mlx
    x-MSI_part2_tumor_target_neg_G.mlx

Part 3: steps to process the organized data of all groups that are generated by codes in Part 1 and 2
    x-MSI_part3_wba_untarget.mlx
    x-MSI_part3_tumor_untarget.mlx
    x-MSI_part3 for tumor_target.mlx

======================================
IV. FUNCTIONS & PARAMETERS
======================================
1. Matlab in-built functions
   tsne, kmeans, gmm, find
   sum, mean, length, size, reshape
   colormap, roipoly, interp2, imagesc, abs

2. customized functions
   batchcdfread, batchmzxmlread
   batchmassimage, indxmig, massimage
   msAverage, profile2centroid

3. parameters
   FilePrefix='A' % depends on raw/cdf files' prefix
   numOfFiles=70; % depends on the number of raw/cdf files

   roimark_neg=[117.0193 118.0504 124.0064 132.0302 140.0117...
    145.0619 151.0261 167.0207 171.0063 175.0240 191.0196 281.2468...
    303.2317 371.1563 465.3057 515.2882 605.3062 663.3416 788.5441 885.5495];

   (optional) roimark_pos=[104.1071 146.1173 147.1128 162.1120 170.0332...
    175.0000 175.1187 189.1595 203.2228 215.2223 296.0648 379.1314...
    429.2393 465.2461 496.2412 756.5503 760.5805 772.5228 798.5383 806.5660];

   (user-defined)
   thres_tic=3E6; thres_pdr=0.01; thres_snr=1.5
   tolerance=0.005;
   TIC normalization magnitude factor: 1E7
   numOfGroup=7 % for wba;
   numOfLabel=15 % for wba;
   numOfGroup=6 % for tumor;
   numOfLabel=3 % for tumor;

=====================================
V. DEMO DATA
=====================================
1. commonly accessed data sets
     cmz_pos:    5370 positive ions from average mass spectrum of WBA sample    
     cmz_neg:    3552 negative ions from average mass spectrum of WBA sample    
     cmz_biopk_pos:  1083*2 matrix, the first column is the ion's index in cmz_pos vector and the second column is the m/z value
     cmz_biopk_neg:  1347*2 matrix, the first column is the ion's index in cmz_neg vector and the second column is the m/z value    
     cmz_posneg_untarget:   2430 positive and negative ions preserved after SNR and PDR-based peak selection
     biopk_indx_neg: row indexes of selected 1347 among the 3552 negative ions; 
     biopk_indx_pos: row indexes of selected 1083 among the 5370 positive ions; 
     
     cmz_pos_dict:   1317 positive ions included in the dictionary (also termed as "library")
     cmz_neg_dict:   498 negative ions included in the dictionary
     cmz_posneg_dict:    1815 positive and negative ions included in the dictionary
     dictionary_pos:   dictionary that only includes 1317 positive ions and their corresponding pathway, function, species, and biotransformation
     dictionary_neg:   dictionary that only includes 498 negative ions and their corresponding pathway, function, species, and biotransformation
     dictionary_posneg_combined:   dictionary that includes all 1815 ions and their corresponding pathway, function, species, and biotransformation
     
     featureArray_wba_untarget_posneg: features extracted from untarget metabolomics data (2430 ions) by t-SNE method at the regional-biomat basis
     featureArray_tumor_untarget_neg: features extracted from untarget metabolomics data (498 ions) by t-SNE method at the regional-biomat basis
     featureArray_tumor_untarget_pos: features extracted from untarget metabolomics data (1317 ions) by t-SNE method at the regional-biomat basis

     packer_wba_untarget_posnegï¼š an organized container that includes all regional biomatrices from different groups of untarget metabolomics data (2430 positive and negative ions)
     packer_tumor_dict_pos: an organized container that includes all regional biomatrices from different groups of targeted metabolomics data (1317 negative ions)
     packer_tumor_dict_neg: an organized container that includes all regional biomatrices from different groups of targeted metabolomics data (498 positive ions)

2. Pretrained Segmentation Models
  2.1 Folder "tumor_segmentor_model (untarget_neg_1347vars)"
    2.1.1 Pretrained models
     model_cosKNN
     model_cubeSVM
     model_LDA
     model_lineSVM
     model_quadSVM
     model_ensembleBagTree
    2.1.2 Training and cross validation datasets
     trainset_neg: 14570 pixels * 1347 ions (TIC normalized data)
     trainlabel_neg: 14570 pixels' label (1: stroma; 2: parenchyma; 3: necrosis)

  2.2 Folder "tumor_segmentor_model (untarget_pos_1083vars)"
    2.2.1 Pretrained models
     model_ensembleBagTree
     model_fgSVM
     model_quadSVM
    2.2.2 Training and cross validation datasets
     trainset_pos: 15307 pixels * 1083 ions
     trainlabel_pos: 15307 pixels' accurate labels (1: stroma; 2: parenchyma; 3: necrosis)

    2.3 Folder "wb_segmentor model (untarget_neg_1347vars)"
     2.3.1 Pretrained model
       model_cosKNN
     2.3.2 Training and cross validation datasets
       trainset_wb_neg: 12764 pixels * 1347 ions
       train_label: 12764s' labels (Label No: 1~15th region)

3. WBA Group-specific spatial metabolomics data sets
   3.1 Folder "WBA/X" "X"= A, C, D, E
     subpeaklistX1
     subpeaklistX2
     roi_X
     biopix_indx_X
     biopk_indx_neg
     biopk_indx_pos     
     cmz_biopk_neg
     cmz_biopk_pos     
     cmz_neg
     cmz_pos
     label_precise_X
     structure_untarget_X

   3.2 Folder "WBA/Y" "Y"=B, F, G
     peaklistY
     roi_Y
     biopix_indx_Y
     biopix_indx_neg
     biopix_indx_pos
     cmz_biopk_neg
     cmz_biopk_pos
     cmz_neg
     cmz_pos
     label_precise_Y
     structure_untarget_Y
 
4. Tumor Group-specific spatial metabolomics data sets
   4.1 Folder "tumor/X" "X"=B, C, D, F, G
    peaklist_neg_X
    peaklist_pos_X
    biopix_indx_neg_X
    biopix_indx_pos_X
    biopk_indx_neg
    biopk_indx_pos
    cmz_biopk_neg
    cmz_biopk_pos
    cmz_neg
    cmz_neg_dict
    label_precise_neg_X
    label_precise_pos_X
    roi_neg_X
    roi_pos_X
    structure_dict_neg_X
    structure_dict_pos_X
    structure_untarget_neg_X
    structure_untarget_pos_X

  4.2 Folder "tumor/Y" "Y"=E
    peaklist_neg_Y
    subpeaklist1_pos_Y
    subpeaklist2_pos_Y
    biopix_indx_neg_Y
    biopix_indx_pos_Y
    biopk_indx_neg
    biopk_indx_pos
    cmz_biopk_neg
    cmz_biopk_pos
    cmz_neg
    cmz_neg_dict
    label_precise_neg_Y
    label_precise_pos_Y
    roi_neg_Y
    roi_pos_Y
    structure_dict_neg_Y
    structure_dict_pos_Y
    structure_untarget_neg_Y
    structure_untarget_pos_Y
  